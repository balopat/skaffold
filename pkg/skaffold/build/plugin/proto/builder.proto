syntax = "proto3";
package proto;

message LabelsRequest {
}

message LabelsResponse {
    map<string, string> labels = 1;
}

message NullableString {
    bool IsNull = 1;

}
message DockerArtifact {
    string DockerfilePath = 1;
    map<string, NullableString> BuildArgs = 2;
    repeated string CacheFrom = 3;
    string Target = 4;
}

message CustomArtifact {
    bytes configuration = 1;
}

message Artifact {
    string ImageName = 1;
    string Workspace = 2;
    map<string, string> Sync = 3;
    oneof type {
        DockerArtifact docker = 4;
        CustomArtifact custom = 5;
    }
}

message BuildRequest {
    repeated Artifact artifacts = 1;
}

message BuildResult {
    string ImageName = 1;
    string Tag = 2;
}

message BuildResponse {
    repeated BuildResult buildResults = 1;
    string error = 2;
}

message ValidationRequest {

}

message ValidationResponse {
    string error = 1;
}

service Builder {
    rpc Labels (LabelsRequest) returns (LabelsResponse);
    rpc Build (BuildRequest) returns (BuildResponse);
    rpc Validate (ValidationRequest) returns (ValidationResponse);
}
